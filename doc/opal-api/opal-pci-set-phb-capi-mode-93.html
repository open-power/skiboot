
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>OPAL_PCI_SET_PHB_CAPI_MODE &#8212; skiboot 326a466
 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="OPAL_PCI_SET_PHB_MEM_WINDOW" href="opal-pci-set-phb-mem-window-28.html" />
    <link rel="prev" title="OPAL_PCI_SET_PELTV" href="opal-pci-set-peltv-32.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="opal-pci-set-phb-mem-window-28.html" title="OPAL_PCI_SET_PHB_MEM_WINDOW"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="opal-pci-set-peltv-32.html" title="OPAL_PCI_SET_PELTV"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">skiboot 326a466
 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">OPAL API Documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">OPAL_PCI_SET_PHB_CAPI_MODE</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="opal-pci-set-phb-capi-mode">
<span id="id1"></span><h1>OPAL_PCI_SET_PHB_CAPI_MODE<a class="headerlink" href="#opal-pci-set-phb-capi-mode" title="Permalink to this headline">¶</a></h1>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define OPAL_PCI_SET_PHB_CAPI_MODE           93</span>

<span class="cm">/* CAPI modes for PHB */</span><span class="w"></span>
<span class="k">enum</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">OPAL_PHB_CAPI_MODE_PCIE</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">OPAL_PHB_CAPI_MODE_CAPI</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">OPAL_PHB_CAPI_MODE_SNOOP_OFF</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">OPAL_PHB_CAPI_MODE_SNOOP_ON</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">OPAL_PHB_CAPI_MODE_DMA</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">OPAL_PHB_CAPI_MODE_DMA_TVT1</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="kt">int64_t</span><span class="w"> </span><span class="nf">opal_pci_set_phb_capi_mode</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">phb_id</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">pe_number</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Switch the CAPP attached to the given PHB in one of the supported CAPI modes.</p>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">phb_id</span></code></dt><dd><p>the ID of the PHB which identifies attached CAPP to perform mode switch on</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">mode</span></code></dt><dd><p>A mode id as described below</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pe_number</span></code></dt><dd><p>PE number for the initiating device</p>
</dd>
</dl>
</section>
<section id="calling">
<h2>Calling<a class="headerlink" href="#calling" title="Permalink to this headline">¶</a></h2>
<p>Switch CAPP attached to the given PHB in one of the following supported modes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OPAL_PHB_CAPI_MODE_PCIE</span>               <span class="o">=</span> <span class="mi">0</span>
<span class="n">OPAL_PHB_CAPI_MODE_CAPI</span>               <span class="o">=</span> <span class="mi">1</span>
<span class="n">OPAL_PHB_CAPI_MODE_SNOOP_OFF</span>    <span class="o">=</span> <span class="mi">2</span>
<span class="n">OPAL_PHB_CAPI_MODE_SNOOP_ON</span>   <span class="o">=</span> <span class="mi">3</span>
<span class="n">OPAL_PHB_CAPI_MODE_DMA</span>                <span class="o">=</span> <span class="mi">4</span>
<span class="n">OPAL_PHB_CAPI_MODE_DMA_TVT1</span>   <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<p>Modes <cite>OPAL_PHB_CAPI_MODE_PCIE</cite> and <cite>OPAL_PHB_CAPI_MODE_CAPI</cite> are used to
enable/disable CAPP attached to the PHB.</p>
<p>Modes <cite>OPAL_PHB_CAPI_MODE_SNOOP_OFF</cite> and <cite>OPAL_PHB_CAPI_MODE_SNOOP_ON</cite> are
used to enable/disable CAPP snooping of Powerbus traffic for cache line
invalidates.</p>
<p>Mode <cite>OPAL_PHB_CAPI_MODE_DMA</cite> and <cite>OPAL_PHB_CAPI_MODE_DMA_TVT1</cite> are used to
enable CAPP DMA mode.</p>
<p>Presently Mode <cite>OPAL_PHB_CAPI_MODE_DMA_TVT1</cite> is exclusively used by the Mellanox
CX5 adapter. Requesting this mode will also indicate to opal that the card
requests maximum number of DMA read engines allocated to improve DMA read
performance at cost of reduced bandwidth available to other traffic including
CAPP-PSL transactions.</p>
</section>
<section id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>If PHB is in PEC2 then requesting mode <cite>OPAL_PHB_CAPI_MODE_DMA_TVT1</cite> will
allocate extra 16/8 dma read engines to the PHB depending on its stack
(stack 0/ stack 1). This is needed to improve the Direct-GPU DMA read
performance for the Mellanox CX5 card.</p></li>
<li><p>Mode <cite>OPAL_PHB_CAPI_MODE_PCIE</cite> not supported on Power-9.</p></li>
<li><p>Requesting mode <cite>OPAL_PHB_CAPI_MODE_CAPI</cite> on Power-9 will disable fast-reboot.</p></li>
<li><p>Modes <cite>OPAL_PHB_CAPI_MODE_DMA</cite>, <cite>OPAL_PHB_CAPI_MODE_SNOOP_OFF</cite> are
not supported on Power-9.</p></li>
<li><p>CAPI is only supported on Power-8 and Power-9.</p></li>
</ul>
</section>
<section id="return-codes">
<h2>Return Codes<a class="headerlink" href="#return-codes" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt><a class="reference internal" href="return-codes.html#opal-success"><span class="std std-ref">OPAL_SUCCESS</span></a></dt><dd><p>Switch to the requested capi mode performed successfully.</p>
</dd>
<dt><a class="reference internal" href="return-codes.html#opal-parameter"><span class="std std-ref">OPAL_PARAMETER</span></a></dt><dd><p>The requested value of mode or phb_id parameter is not valid.</p>
</dd>
<dt><a class="reference internal" href="return-codes.html#opal-hardware"><span class="std std-ref">OPAL_HARDWARE</span></a></dt><dd><p>An error occurred while switching the CAPP to requested mode.</p>
</dd>
<dt><a class="reference internal" href="return-codes.html#opal-unsupported"><span class="std std-ref">OPAL_UNSUPPORTED</span></a></dt><dd><p>Switching to requested capi mode is not possible at the moment</p>
</dd>
<dt><a class="reference internal" href="return-codes.html#opal-resource"><span class="std std-ref">OPAL_RESOURCE</span></a></dt><dd><p>CAPP ucode not available hence activating CAPP not supported.</p>
</dd>
<dt><a class="reference internal" href="return-codes.html#opal-busy"><span class="std std-ref">OPAL_BUSY</span></a></dt><dd><p>CAPP is presently in recovery-mode and mode switch cannot be performed.</p>
</dd>
</dl>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">OPAL_PCI_SET_PHB_CAPI_MODE</a><ul>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#calling">Calling</a></li>
<li><a class="reference internal" href="#notes">Notes</a></li>
<li><a class="reference internal" href="#return-codes">Return Codes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="opal-pci-set-peltv-32.html"
                        title="previous chapter">OPAL_PCI_SET_PELTV</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="opal-pci-set-phb-mem-window-28.html"
                        title="next chapter">OPAL_PCI_SET_PHB_MEM_WINDOW</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/opal-api/opal-pci-set-phb-capi-mode-93.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="opal-pci-set-phb-mem-window-28.html" title="OPAL_PCI_SET_PHB_MEM_WINDOW"
             >next</a> |</li>
        <li class="right" >
          <a href="opal-pci-set-peltv-32.html" title="OPAL_PCI_SET_PELTV"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">skiboot 326a466
 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >OPAL API Documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">OPAL_PCI_SET_PHB_CAPI_MODE</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2017, IBM, others.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>