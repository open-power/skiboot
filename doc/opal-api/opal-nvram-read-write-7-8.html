
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>OPAL NVRAM &#8212; skiboot 326a466
 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Get/Set System Parameters" href="opal-param-89-90.html" />
    <link rel="prev" title="OPAL_NPU_SPA_SETUP" href="opal-npu2-opencapi-159-160-161-171-172.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="opal-param-89-90.html" title="Get/Set System Parameters"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="opal-npu2-opencapi-159-160-161-171-172.html" title="OPAL_NPU_SPA_SETUP"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">skiboot 326a466
 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">OPAL API Documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">OPAL NVRAM</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="opal-nvram">
<span id="nvram"></span><h1>OPAL NVRAM<a class="headerlink" href="#opal-nvram" title="Permalink to this headline">¶</a></h1>
<p>The NVRAM requirements for OPAL systems is derived from LoPAPR, and all
requirements listed in it apply to OPAL with some exceptions. Note that
Section 8.4.1.1.3 “OF Configuration Variables” does NOT apply to OPAL,
neither does 8.4.1.2 “DASD Spin-up Control”. Not that the RTAS calls of
<cite>nvram-fetch</cite> and <cite>nvram-store</cite> are roughly equivalent to the
<a class="reference internal" href="#opal-read-nvram"><span class="std std-ref">OPAL_READ_NVRAM</span></a> and <a class="reference internal" href="#opal-write-nvram"><span class="std std-ref">OPAL_WRITE_NVRAM</span></a> calls.</p>
<p>LoPAPR has a minimum requirement of 8KB of Non-Volatile Memory. While this
requirement carries over, it’s important to note that historically all OPAL
systems have had roughly 500kb of NVRAM.</p>
<p>See <a class="reference internal" href="../device-tree/ibm%2Copal/nvram.html#device-tree-ibm-opal-nvram"><span class="std std-ref">nvram Device Tree Node</span></a> for details on how NVRAM is represented
in the device tree. It’s fairly simple, it looks like this:</p>
<div class="highlight-dts notranslate"><div class="highlight"><pre><span></span><span class="nc">nvram</span> <span class="p">{</span>
      <span class="nf">compatible</span> <span class="o">=</span> <span class="s">&quot;ibm,opal-nvram&quot;</span><span class="p">;</span>
      <span class="nf">#bytes</span> <span class="o">=</span> <span class="p">&lt;</span><span class="mh">0x90000</span><span class="p">&gt;;</span>
<span class="p">};</span>
</pre></div>
</div>
<section id="opal-read-nvram">
<span id="id1"></span><h2>OPAL_READ_NVRAM<a class="headerlink" href="#opal-read-nvram" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define OPAL_READ_NVRAM                         7</span>

<span class="kt">int64_t</span><span class="w"> </span><span class="nf">opal_read_nvram</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">offset</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p><a class="reference internal" href="#opal-read-nvram"><span class="std std-ref">OPAL_READ_NVRAM</span></a> call requests OPAL to read the data from system NVRAM
memory into a memory buffer. The data at <code class="docutils literal notranslate"><span class="pre">offset</span></code> from nvram_image
will be copied to memory <code class="docutils literal notranslate"><span class="pre">buffer</span></code> of size <code class="docutils literal notranslate"><span class="pre">size</span></code>.</p>
<p>This is a <em>synchronous</em> OPAL call, as OPAL will typically read the content of
NVRAM from its storage (typically flash) during boot, so the call duration
should be along the lines of a <code class="docutils literal notranslate"><span class="pre">memcpy()</span></code> operation rather than reading
from storage.</p>
<section id="parameters">
<h3>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uint64_t</span> <span class="n">buffer</span>
<span class="n">uint64_t</span> <span class="n">size</span>
<span class="n">uint64_t</span> <span class="n">offset</span>
</pre></div>
</div>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">buffer</span></code></dt><dd><p>the data from nvram will be copied to <code class="docutils literal notranslate"><span class="pre">buffer</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size</span></code></dt><dd><p>the data of size <code class="docutils literal notranslate"><span class="pre">size</span></code> will be copied</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">offset</span></code></dt><dd><p>the data will be copied from address equal to base <code class="docutils literal notranslate"><span class="pre">nvram_image</span></code> plus <code class="docutils literal notranslate"><span class="pre">offset</span></code></p>
</dd>
</dl>
</section>
<section id="return-values">
<h3>Return Values<a class="headerlink" href="#return-values" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt><a class="reference internal" href="return-codes.html#opal-success"><span class="std std-ref">OPAL_SUCCESS</span></a></dt><dd><p>data from nvram to memory <code class="docutils literal notranslate"><span class="pre">buffer</span></code> copied successfully</p>
</dd>
<dt><a class="reference internal" href="return-codes.html#opal-parameter"><span class="std std-ref">OPAL_PARAMETER</span></a></dt><dd><p>a parameter <code class="docutils literal notranslate"><span class="pre">offset</span></code> or <code class="docutils literal notranslate"><span class="pre">size</span></code> was incorrect</p>
</dd>
<dt><a class="reference internal" href="return-codes.html#opal-hardware"><span class="std std-ref">OPAL_HARDWARE</span></a></dt><dd><p>either nvram is not initialized or permanent error related to nvram hardware.</p>
</dd>
</dl>
</section>
</section>
<section id="opal-write-nvram">
<span id="id2"></span><h2>OPAL_WRITE_NVRAM<a class="headerlink" href="#opal-write-nvram" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define OPAL_WRITE_NVRAM                        8</span>

<span class="kt">int64_t</span><span class="w"> </span><span class="nf">opal_write_nvram</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">offset</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p><a class="reference internal" href="#opal-write-nvram"><span class="std std-ref">OPAL_WRITE_NVRAM</span></a> call requests OPAL to write the data to actual system NVRAM memory
from memory <code class="docutils literal notranslate"><span class="pre">buffer</span></code> at <code class="docutils literal notranslate"><span class="pre">offset</span></code>, of size <code class="docutils literal notranslate"><span class="pre">size</span></code></p>
<section id="id3">
<h3>Parameters<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uint64_t</span> <span class="n">buffer</span>
<span class="n">uint64_t</span> <span class="n">size</span>
<span class="n">uint64_t</span> <span class="n">offset</span>
</pre></div>
</div>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">buffer</span></code></dt><dd><p>data from <code class="docutils literal notranslate"><span class="pre">buffer</span></code> will be copied to nvram</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size</span></code></dt><dd><p>the data of size <code class="docutils literal notranslate"><span class="pre">size</span></code> will be copied</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">offset</span></code></dt><dd><p>the data will be copied to address which is equal to base <code class="docutils literal notranslate"><span class="pre">nvram_image</span></code> plus <code class="docutils literal notranslate"><span class="pre">offset</span></code></p>
</dd>
</dl>
</section>
<section id="id4">
<h3>Return Values<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt><a class="reference internal" href="return-codes.html#opal-success"><span class="std std-ref">OPAL_SUCCESS</span></a></dt><dd><p>data from memory <code class="docutils literal notranslate"><span class="pre">buffer</span></code> to actual nvram_image copied successfully</p>
</dd>
<dt><a class="reference internal" href="return-codes.html#opal-parameter"><span class="std std-ref">OPAL_PARAMETER</span></a></dt><dd><p>a parameter <code class="docutils literal notranslate"><span class="pre">offset</span></code> or <code class="docutils literal notranslate"><span class="pre">size</span></code> was incorrect</p>
</dd>
<dt><a class="reference internal" href="return-codes.html#opal-hardware"><span class="std std-ref">OPAL_HARDWARE</span></a></dt><dd><p>either nvram is not initialized or permanent error related to nvram hardware.</p>
</dd>
<dt><a class="reference internal" href="return-codes.html#opal-busy"><span class="std std-ref">OPAL_BUSY</span></a></dt><dd><p>OPAL is currently busy, retry the <a class="reference internal" href="#opal-write-nvram"><span class="std std-ref">OPAL_WRITE_NVRAM</span></a> call.</p>
</dd>
<dt><a class="reference internal" href="return-codes.html#opal-busy-event"><span class="std std-ref">OPAL_BUSY_EVENT</span></a></dt><dd><p>OPAL is currently busy, call <a class="reference internal" href="opal-poll-events.html#opal-poll-events"><span class="std std-ref">OPAL_POLL_EVENTS</span></a> and then retry <a class="reference internal" href="#opal-write-nvram"><span class="std std-ref">OPAL_WRITE_NVRAM</span></a></p>
</dd>
</dl>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">OPAL NVRAM</a><ul>
<li><a class="reference internal" href="#opal-read-nvram">OPAL_READ_NVRAM</a><ul>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#return-values">Return Values</a></li>
</ul>
</li>
<li><a class="reference internal" href="#opal-write-nvram">OPAL_WRITE_NVRAM</a><ul>
<li><a class="reference internal" href="#id3">Parameters</a></li>
<li><a class="reference internal" href="#id4">Return Values</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="opal-npu2-opencapi-159-160-161-171-172.html"
                        title="previous chapter">OPAL_NPU_SPA_SETUP</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="opal-param-89-90.html"
                        title="next chapter">Get/Set System Parameters</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/opal-api/opal-nvram-read-write-7-8.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="opal-param-89-90.html" title="Get/Set System Parameters"
             >next</a> |</li>
        <li class="right" >
          <a href="opal-npu2-opencapi-159-160-161-171-172.html" title="OPAL_NPU_SPA_SETUP"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">skiboot 326a466
 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >OPAL API Documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">OPAL NVRAM</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2017, IBM, others.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>