
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>skiboot-6.0-rc2 &#8212; skiboot 326a466
 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="skiboot-6.0.1" href="skiboot-6.0.1.html" />
    <link rel="prev" title="skiboot-6.0-rc1" href="skiboot-6.0-rc1.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="skiboot-6.0.1.html" title="skiboot-6.0.1"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="skiboot-6.0-rc1.html" title="skiboot-6.0-rc1"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">skiboot 326a466
 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Release Notes</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">skiboot-6.0-rc2</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="skiboot-6-0-rc2">
<span id="id1"></span><h1>skiboot-6.0-rc2<a class="headerlink" href="#skiboot-6-0-rc2" title="Permalink to this headline">¶</a></h1>
<p>skiboot v6.0-rc2 was released on Wednesday May 9th 2018. It is the second
release candidate of skiboot 6.0, which will become the new stable release
of skiboot following the 5.11 release, first released April 6th 2018.</p>
<p>Skiboot 6.0 will mark the basis for op-build v2.0 and will be required for
POWER9 systems.</p>
<p>skiboot v6.0-rc2 contains all bug fixes as of <a class="reference internal" href="skiboot-5.11.html#skiboot-5-11"><span class="std std-ref">skiboot-5.11</span></a>,
<a class="reference internal" href="skiboot-5.10.5.html#skiboot-5-10-5"><span class="std std-ref">skiboot-5.10.5</span></a>, and <a class="reference internal" href="skiboot-5.4.9.html#skiboot-5-4-9"><span class="std std-ref">skiboot-5.4.9</span></a> (the currently maintained
stable releases). Once 6.0 is released, we do <em>not</em> expect any further
stable releases in the 5.10.x series, nor in the 5.11.x series.</p>
<p>For how the skiboot stable releases work, see <a class="reference internal" href="../process/stable-skiboot-rules.html#stable-rules"><span class="std std-ref">Skiboot stable tree rules and releases</span></a> for details.</p>
<p>The current plan is to cut the final 6.0 in early May (maybe in a day or two
after this -rc if things look okay), with skiboot 6.0
being for all POWER8 and POWER9 platforms in op-build v2.0.</p>
<p>Over skiboot-6.0-rc1, we have the following changes:</p>
<ul>
<li><p>Update default stop-state-disable mask to cut only stop11</p>
<p>Stability improvements in microcode for stop4/stop5 are
available in upstream hcode images. Stop4 and stop5 can
be safely enabled by default.</p>
<p>Use ~0xE0000000 to cut all but stop0,1,2 in case there
are any issues with stop4/5.</p>
<p>example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nvram</span> <span class="o">-</span><span class="n">p</span> <span class="n">ibm</span><span class="p">,</span><span class="n">skiboot</span> <span class="o">--</span><span class="n">update</span><span class="o">-</span><span class="n">config</span> <span class="n">opal</span><span class="o">-</span><span class="n">stop</span><span class="o">-</span><span class="n">state</span><span class="o">-</span><span class="n">disable</span><span class="o">-</span><span class="n">mask</span><span class="o">=</span><span class="mh">0x1FFFFFFF</span>
</pre></div>
</div>
<p><strong>Note</strong>: that DD2.1 chips that have a frequency &lt;1867Mhz possible <em>need</em> to
run a hcode image <em>different</em> than the default in op-build (set
<cite>BR2_HCODE_LATEST_VERSION=y</cite> in your config)</p>
</li>
<li><p>ibm,firmware-versions: add hcode to device tree</p>
<p>op-build commit 736a08b996e292a449c4996edb264011dfe56a40
added hcode to the VERSION partition, let’s parse it out
and let the user know.</p>
</li>
<li><p>ipmi: Add BMC firmware version to device tree</p>
<p>BMC Get device ID command gives BMC firmware version details. Lets add this
to device tree. User space tools will use this information to display BMC
version details.</p>
</li>
<li><p>mambo: Enable XER CA32 and OV32 bits on P9</p>
<p>POWER9 adds 32 bit carry and overflow bits to the XER, but we need to
set the relevant CTRL1 bit to enable them.</p>
</li>
<li><p>Makefile: Fix building natively on ppc64le</p>
<p>When on ppc64le and CROSS is not set by the environment, make assumes
ppc64 and sets a default CROSS. Check for ppc64le as well, so that
‘make’ works out of the box on ppc64le.</p>
</li>
<li><p>p9dsu: timeout for variant detection, default to 2uess</p></li>
<li><p>core/direct-controls: improve p9_stop_thread error handling</p>
<p>p9_stop_thread should fail the operation if it finds the thread was
already quiescd. This implies something else is doing direct controls
on the thread (e.g., pdbg) or there is some exceptional condition we
don’t know how to deal with. Proceeding here would cause things to
trample on each other, for example the hard lockup watchdog trying to
send a sreset to the core while it is stopped for debugging with pdbg
will end in tears.</p>
<p>If p9_stop_thread times out waiting for the thread to quiesce, do
not hit it with a core_start direct control, because we don’t know
what state things are in and doing more things at this point is worse
than doing nothing. There is no good recipe described in the workbook
to de-assert the core_stop control if it fails to quiesce the thread.
After timing out here, the thread may eventually quiesce and get
stuck, but that’s simpler to debug than undefied behaviour.</p>
</li>
<li><p>core/direct-controls: fix p9_cont_thread for stopped/inactive threads</p>
<p>Firstly, p9_cont_thread should check that the thread actually was
quiesced before it tries to resume it. Anything could happen if we
try this from an arbitrary thread state.</p>
<p>Then when resuming a quiesced thread that is inactive or stopped (in
a stop idle state), we must not send a core_start direct control,
clear_maint must be used in these cases.</p>
</li>
<li><p>occ: Use major version number while checking the pstate table format</p>
<p>The minor version increments of the pstate table are backward
compatible. The minor version is changed when the pstate table
remains same and the existing reserved bytes are used for pointing
new data. So use only major version number while parsing the pstate
table. This will allow old skiboot to parse the pstate table and
handle minor version updates.</p>
</li>
<li><p>hmi: Clear unknown debug trigger</p>
<p>On some systems, seeing hangs like this when Linux starts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="mf">170.027252763</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="n">OCC</span><span class="p">:</span> <span class="n">All</span> <span class="n">Chip</span> <span class="n">Rdy</span> <span class="n">after</span> <span class="mi">0</span> <span class="n">ms</span>
<span class="p">[</span> <span class="mf">170.062930145</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="n">INIT</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">kernel</span> <span class="n">at</span> <span class="mh">0x20011000</span><span class="p">,</span> <span class="n">fdt</span> <span class="n">at</span> <span class="mh">0x30ae0530</span> <span class="mi">366247</span> <span class="nb">bytes</span><span class="p">)</span>
<span class="p">[</span> <span class="mf">171.238270428</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="n">OPAL</span><span class="p">:</span> <span class="n">Switch</span> <span class="n">to</span> <span class="n">little</span><span class="o">-</span><span class="n">endian</span> <span class="n">OS</span>
</pre></div>
</div>
<p>If you look at the in memory skiboot console (or do <cite>nvram -p
ibm,skiboot –update-config log-level-driver=7</cite>) we see the console get
spammed with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="mf">5209.109790675</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="n">HMI</span><span class="p">:</span> <span class="n">Received</span> <span class="n">HMI</span> <span class="n">interrupt</span><span class="p">:</span> <span class="n">HMER</span> <span class="o">=</span> <span class="mh">0x0000400000000000</span>
<span class="p">[</span> <span class="mf">5209.109792716</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="n">HMI</span><span class="p">:</span> <span class="n">Received</span> <span class="n">HMI</span> <span class="n">interrupt</span><span class="p">:</span> <span class="n">HMER</span> <span class="o">=</span> <span class="mh">0x0000400000000000</span>
<span class="p">[</span> <span class="mf">5209.109794695</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="n">HMI</span><span class="p">:</span> <span class="n">Received</span> <span class="n">HMI</span> <span class="n">interrupt</span><span class="p">:</span> <span class="n">HMER</span> <span class="o">=</span> <span class="mh">0x0000400000000000</span>
<span class="p">[</span> <span class="mf">5209.109796689</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="n">HMI</span><span class="p">:</span> <span class="n">Received</span> <span class="n">HMI</span> <span class="n">interrupt</span><span class="p">:</span> <span class="n">HMER</span> <span class="o">=</span> <span class="mh">0x0000400000000000</span>
</pre></div>
</div>
<p>We’re taking the debug trigger (bit 17) early on, before the
hmi_debug_trigger function in the kernel is set up.</p>
<p>This clears the HMI in Skiboot and reports to the kernel instead of
bringing down the machine.</p>
</li>
<li><p>core/hmi: assign flags=0 in case nothing set by handle_hmi_exception</p>
<p>Theoretically we could have returned junk to the OS in this parameter.</p>
</li>
<li><p>SLW: Fix mambo boot to use stop states</p>
<p>After commit 35c66b8ce5a2 (“SLW: Move MAMBO simulator checks to
slw_init”), mambo boot no longer calls add_cpu_idle_state_properties()
and as such we never enable stop states.</p>
<p>After adding the call back, we get more testing coverage as well
as faster mambo SMT boots.</p>
</li>
<li><p>phb4: Hardware init updates</p>
<p>CFG Write Request Timeout was incorrectly set to informational and not
fatal for both non-CAPI and CAPI, so set it to fatal.  This was a
mistake in the specification.  Correcting this fixes a niche bug in
escalation (which is necessary on pre-DD2.2) that can cause a checkstop
due to a NCU timeout.</p>
<p>In addition, set the values in the timeout control registers to match.
This fixes an extremely rare and unreproducible bug, though the current
timings don’t make sense since they’re higher than the NCU timeout (16)
which will checkstop the machine anyway.</p>
</li>
<li><p>SLW: quieten ‘Configuring self-restore’ for DARN,NCU_SPEC_BAR and HRMOR</p></li>
<li><p>Experimental support for building with Clang</p></li>
<li><p>Improvements to testing and Travis CI</p></li>
</ul>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="skiboot-6.0-rc1.html"
                        title="previous chapter">skiboot-6.0-rc1</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="skiboot-6.0.1.html"
                        title="next chapter">skiboot-6.0.1</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/release-notes/skiboot-6.0-rc2.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="skiboot-6.0.1.html" title="skiboot-6.0.1"
             >next</a> |</li>
        <li class="right" >
          <a href="skiboot-6.0-rc1.html" title="skiboot-6.0-rc1"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">skiboot 326a466
 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Release Notes</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">skiboot-6.0-rc2</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2017, IBM, others.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>